<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Algoritmos Greedy - Neo4j</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .algorithm-section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .algorithm-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .input-group {
            margin: 20px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .results {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            display: none;
        }

        .results.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .truck-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .truck-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .truck-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .truck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .truck-id {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 1s ease;
        }

        .load-list {
            list-style: none;
            margin-top: 10px;
        }

        .load-item {
            background: #f0f0f0;
            padding: 8px 12px;
            border-radius: 5px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .error-message {
            background: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success-message {
            background: #00C851;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #667eea;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .badge-success {
            background: #00C851;
            color: white;
        }

        .badge-warning {
            background: #ffbb33;
            color: white;
        }

        .badge-info {
            background: #33b5e5;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ Algoritmos Greedy - Neo4j</h1>
        <p class="subtitle">Sistema de Distribuci√≥n Log√≠stica en Tiempo Real</p>

        <!-- Algoritmo 1: Distribuci√≥n de Combustible -->
        <div class="algorithm-section">
            <div class="algorithm-title">
                ‚õΩ Distribuci√≥n de Combustible Optimizado
            </div>
            <p style="color: #666; margin-bottom: 20px;">
                Algoritmo Greedy que prioriza camiones con menor porcentaje de combustible actual.
            </p>

            <div class="input-group">
                <label for="combustible-disponible">Combustible Disponible (litros):</label>
                <input type="number" id="combustible-disponible" value="2000" min="0">
            </div>

            <button class="btn" onclick="distribuirCombustible()">
                Ejecutar Distribuci√≥n de Combustible
            </button>

            <div id="result-combustible" class="results"></div>
        </div>

        <!-- Algoritmo 2: Distribuci√≥n de Peso -->
        <div class="algorithm-section">
            <div class="algorithm-title">
                üì¶ Distribuci√≥n de Peso (First Fit Decreasing)
            </div>
            <p style="color: #666; margin-bottom: 20px;">
                Ordena cargas por peso descendente y asigna al primer cami√≥n con capacidad disponible.
            </p>

            <div class="input-group">
                <label for="cargas-peso">Cargas a Distribuir (pesos en kg, separados por comas):</label>
                <input type="text" id="cargas-peso" value="12000, 8500, 6000, 4500, 3000, 2000, 1500, 10000">
            </div>

            <button class="btn" onclick="distribuirPeso()">
                Ejecutar Distribuci√≥n de Peso
            </button>

            <div id="result-peso" class="results"></div>
        </div>

        <!-- Algoritmo 3: Asignaci√≥n desde Centros -->
        <div class="algorithm-section">
            <div class="algorithm-title">
                üè¢ Asignaci√≥n de Cargas desde Centros de Distribuci√≥n
            </div>
            <p style="color: #666; margin-bottom: 20px;">
                Asigna cargas desde centros priorizando por nivel de prioridad y demanda.
            </p>

            <button class="btn" onclick="asignarDesdeCentros()">
                Ejecutar Asignaci√≥n desde Centros
            </button>

            <div id="result-centros" class="results"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/greedy';

        async function distribuirCombustible() {
            const combustible = document.getElementById('combustible-disponible').value;
            const resultDiv = document.getElementById('result-combustible');
            
            resultDiv.innerHTML = '<div class="loading">‚è≥ Procesando...</div>';
            resultDiv.classList.add('show');

            try {
                const response = await fetch(`${API_BASE}/distribuir-combustible-optimizado?combustibleDisponible=${combustible}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                
                let html = '<div class="success-message">‚úÖ Distribuci√≥n completada exitosamente</div>';
                
                // Estad√≠sticas
                html += '<div class="stats-grid">';
                html += `<div class="stat-card">
                    <div class="stat-label">Combustible Disponible</div>
                    <div class="stat-value">${data.combustibleDisponible}L</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Combustible Asignado</div>
                    <div class="stat-value">${data.combustibleAsignado}L</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Combustible Restante</div>
                    <div class="stat-value">${data.combustibleRestante}L</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Camiones Atendidos</div>
                    <div class="stat-value">${data.totalCamiones}</div>
                </div>`;
                html += '</div>';

                // Detalle de camiones
                html += '<h3 style="margin-top: 30px; color: #667eea;">Detalle por Cami√≥n:</h3>';
                html += '<div class="truck-list">';
                
                data.camionesDetalle.forEach(camion => {
                    const porcentaje = camion.porcentajeFinal.toFixed(1);
                    html += `
                        <div class="truck-card">
                            <div class="truck-header">
                                <div class="truck-id">${camion.truckId}</div>
                                <div class="badge badge-info">${camion.licensePlate}</div>
                            </div>
                            <div><strong>Combustible Actual:</strong> ${camion.combustibleActual}L</div>
                            <div><strong>Necesidad:</strong> ${camion.necesidad}L</div>
                            <div><strong>Asignado:</strong> <span style="color: #00C851; font-weight: bold;">${camion.combustibleAsignado}L</span></div>
                            <div><strong>Nivel Final:</strong> ${camion.combustibleFinal}L / ${camion.capacidadTotal}L</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${porcentaje}%">
                                    ${porcentaje}%
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function distribuirPeso() {
            const cargasText = document.getElementById('cargas-peso').value;
            const cargas = cargasText.split(',').map(c => parseInt(c.trim()));
            const resultDiv = document.getElementById('result-peso');
            
            resultDiv.innerHTML = '<div class="loading">‚è≥ Procesando...</div>';
            resultDiv.classList.add('show');

            try {
                const response = await fetch(`${API_BASE}/distribuir-peso`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cargas)
                });

                const data = await response.json();
                
                let html = '<div class="success-message">‚úÖ Distribuci√≥n completada exitosamente</div>';
                
                // Estad√≠sticas
                html += '<div class="stats-grid">';
                html += `<div class="stat-card">
                    <div class="stat-label">Total Cargas</div>
                    <div class="stat-value">${data.totalCargas}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Cargas Asignadas</div>
                    <div class="stat-value">${data.cargasAsignadas}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Peso Total</div>
                    <div class="stat-value">${(data.pesoTotalAsignado / 1000).toFixed(1)}t</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Camiones Usados</div>
                    <div class="stat-value">${data.totalCamiones}</div>
                </div>`;
                html += '</div>';

                if (data.cargasNoAsignadas && data.cargasNoAsignadas.length > 0) {
                    html += `<div class="error-message">‚ö†Ô∏è ${data.cargasNoAsignadas.length} cargas no pudieron ser asignadas</div>`;
                }

                // Detalle de camiones
                html += '<h3 style="margin-top: 30px; color: #667eea;">Detalle por Cami√≥n:</h3>';
                html += '<div class="truck-list">';
                
                data.detalleUtilizacion.forEach(camion => {
                    if (camion.numeroCargasAsignadas > 0) {
                        const porcentaje = camion.porcentajeUtilizacion.toFixed(1);
                        html += `
                            <div class="truck-card">
                                <div class="truck-header">
                                    <div class="truck-id">${camion.truckId}</div>
                                    <div class="badge badge-success">${camion.licensePlate}</div>
                                </div>
                                <div><strong>Capacidad:</strong> ${(camion.capacidadTotal / 1000).toFixed(1)}t</div>
                                <div><strong>Peso Asignado:</strong> ${(camion.pesoAsignado / 1000).toFixed(1)}t</div>
                                <div><strong>Disponible:</strong> ${(camion.capacidadDisponible / 1000).toFixed(1)}t</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min(porcentaje, 100)}%">
                                        ${porcentaje}%
                                    </div>
                                </div>
                                <ul class="load-list">
                                    ${camion.cargasAsignadas.map(carga => 
                                        `<li class="load-item">
                                            <span>Carga</span>
                                            <strong>${(carga / 1000).toFixed(1)}t</strong>
                                        </li>`
                                    ).join('')}
                                </ul>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function asignarDesdeCentros() {
            const resultDiv = document.getElementById('result-centros');
            
            resultDiv.innerHTML = '<div class="loading">‚è≥ Procesando...</div>';
            resultDiv.classList.add('show');

            try {
                const response = await fetch(`${API_BASE}/asignar-cargas-desde-centros`, {
                    method: 'GET'
                });

                const data = await response.json();
                
                let html = '<div class="success-message">‚úÖ Asignaci√≥n completada exitosamente</div>';
                
                // Estad√≠sticas
                html += '<div class="stats-grid">';
                html += `<div class="stat-card">
                    <div class="stat-label">Total Centros</div>
                    <div class="stat-value">${data.totalCargas}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Cargas Asignadas</div>
                    <div class="stat-value">${data.cargasAsignadas}</div>
                </div>`;
                html += `<div class="stat-card">
                    <div class="stat-label">Camiones Usados</div>
                    <div class="stat-value">${data.totalCamiones}</div>
                </div>`;
                html += '</div>';

                // Detalle de asignaciones
                html += '<h3 style="margin-top: 30px; color: #667eea;">Asignaciones por Cami√≥n:</h3>';
                html += '<div class="truck-list">';
                
                data.detalleAsignaciones.forEach(camion => {
                    if (camion.numeroAsignaciones > 0) {
                        const porcentaje = camion.porcentajeUtilizacion.toFixed(1);
                        html += `
                            <div class="truck-card">
                                <div class="truck-header">
                                    <div class="truck-id">${camion.truckId}</div>
                                    <div class="badge badge-info">${camion.licensePlate}</div>
                                </div>
                                <div><strong>Capacidad:</strong> ${(camion.capacidadTotal / 1000).toFixed(1)}t</div>
                                <div><strong>Peso Total:</strong> ${(camion.pesoTotal / 1000).toFixed(1)}t</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min(porcentaje, 100)}%">
                                        ${porcentaje}%
                                    </div>
                                </div>
                                <h4 style="margin: 15px 0 10px 0; color: #667eea;">Centros Asignados:</h4>
                                <ul class="load-list">
                                    ${camion.asignaciones.map(asig => 
                                        `<li class="load-item">
                                            <span style="font-size: 0.9em;">${asig.centroNombre}</span>
                                            <strong>${(asig.peso / 1000).toFixed(1)}t</strong>
                                        </li>`
                                    ).join('')}
                                </ul>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>

